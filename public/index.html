<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <link href="http://sklise.s3.amazonaws.com/pictos/pictos.css" rel="stylesheet" type="text/css"></link>
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/vendor/jquery.min.js" type="text/javascript"></script>
  <script src="/js/vendor/underscore-min.js" type="text/javascript"></script>
  <script src="/js/vendor/backbone-min.js" type="text/javascript"></script>
  <script src="/js/vendor/mustache.js" type="text/javascript"></script>
  <script src="/nowjs/now.js"></script>
  <script src="/js/utils.js"></script>
  <script src="/js/models.js"></script>
  <script src="/js/collections.js"></script>
  <script src="/js/views.js"></script>
  <script src="/js/itpirl.js"></script>
  <script src="/js/chat.js"></script>
  <script>
    $(document).ready(function(){
      $('#feedback-button').click(function(){
        event.preventDefault();
        $feedbackForm = $('#feedback-form');
        if($feedbackForm.html().length == 0) {
          $feedbackForm.append(Mustache.render($('#feedback-form-template').html(), {name:now.name}));
        } else {
          $feedbackForm.empty();
        }
      });
    
      $('#feedback-send').live('click', function(){
        event.preventDefault();
        data = {
          name:$('#feedback-name').val(),
          message:$('#feedback-message').val()
        }
        $.post('/feedback/new', data, function(response){
          $('#feedback-form').empty();
        });
      });
      
      $('#user-toggle').click(function(){
        if($(this).find('#user-list').length == 0) {
          $userList = $('<div/>').attr('id','user-list');
          $(this).append($userList);
          names=""
          _.each(now.userList, function(name){ names+= '<li>'+name+'</li>'})
          $userList.html('<ul>'+names+'</ul>').css('width',$(this).width());
        } else {
          $('#user-list').remove();
        }
      });
    });
  </script>
  
  <title>ITPIRL</title>
</head>
<body>
  <div id="header">
    <h1>ITPIRL</h1>

    <div id="feedback">
      <button id="feedback-button"><span class="pictos">W</span> Feedback</button>
      <div id="feedback-form"></div>
    </div>
  </div>

  <div id="wrapper">
    <div id="toolbars">
      <div id="chat-toolbar">
        <div id="user-toggle">
          <span class="pictos">+</span> Users
        </div>
      </div>
    </div>
    
  <div id="content">
    <div id="chat-window">
      <div id="chat-log-container">
        <ul id="chat-log">
        </ul>
      </div>
      <form id="new-message">
        <input id="chat-name" />
        <textarea id="new-message-input" autofocus rows=1></textarea>
        <script>
            if (!("autofocus" in document.createElement("textarea"))) {
              document.getElementById("new-message-input").focus();
            }
          </script>
      </form>
    </div>
    <div id="event-window">
      <div class="introduction">
        <h2>Welcome to ITPIRL.</h2>
        <h3>v. 0.7.4</h3>
        <p><em>Best viewed in Safari or Chrome.</em></p>
        <p>To your left is a chat room, below <del>are</del> <em>will soon be</em> this week's events from the ITP Student Google Calendar.</p>
        <p>There's a bot living in the chat room, his name is Shep and he's a dog. Currently he isn't standing still for pictures but don't worry, he won't bite. Type "shep help" (and press enter) in chat to see all of his tricks.</p>
        <p><strong>PRIVACY:</strong> This site is private only in the sense that probably no one knows about it. All content is currently publicly accessible. So watch ur lolz.</p>
        <p><strong>BETA:</strong> This website is in beta, until 1.0.0 expect slow response and broken functionality. Click the button in the top right corner to give feedback please!</p>
        
        <p><strong>LICENSE:</strong> All code is open source under the <a href="https://github.com/stevenklise/itpirl/blob/master/License.md" target="_blank">MIT License</a>. Source code is available on <a href="https://github.com/stevenklise/itpirl" target="_blank">Github</a></p>
      </div>
    </div>
  </div>
  </div>

  <script type="text/template" id="messages-template">
    <div id="chat-log-container">
      <ul id="chat-log">
      </ul>
    </div>
    <form id="new-message">
      <div id="ask-shep" class="pictos">p</div>
      <textarea id="new-message-input" rows=1></textarea>
    </form>
  </script>

  <script type="text/template" id="system-message-template">
  <li class="{{ classes }}">
    <div class="message-time">{{ time }}</div>
    <div class="system-message">{{{ message }}}</div>
  </li>
  </script>

  <script type="text/template" id="message-template">
  <li class="{{ classes }}">
    <div class="chatter">{{ name }}</div>
    <div class="message-time">{{ time }}</div>
    <div class="message">{{{ message }}}</div>
  </li>
  </script>

  <script type="text/template" id="events-template">
    <ul>
    </ul>
  </script>

  <script type="text/template" id="event-date">
    
  </script>

  <script type="text/template" id="event-template">
    <div>
      <span class="time">{{ startTime }}-{{ endTime }}</span> {{ title }} 
      <a class="calendar-link pictos" title="Open in Google Calendar" target="_blank" href="{{ url }}">\</a>
      <div class="details">
        <p class="location">{{ location }}</p>
        <div>{{ description }}</p>
      </div>
    </div>
  </script>

  <script type="text/template" id="feedback-form-template">
    <div>
    <label>Your Name: <input type="text" id="feedback-name" value="{{ name }}"/></label>
    <label>Feedback:</label>
    <textarea id="feedback-message"></textarea>
    <button id="feedback-send">Send Feedback</button>
    </div>
  </script>
</body>
</html>